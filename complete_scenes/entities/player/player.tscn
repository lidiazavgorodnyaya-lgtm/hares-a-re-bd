[gd_scene load_steps=38 format=3 uid="uid://xn5yhb7a3dga"]

[ext_resource type="Script" uid="uid://cmcttel0tywal" path="res://complete_scenes/entities/player/player.gd" id="1_2ja1o"]
[ext_resource type="Script" uid="uid://bkm2qpcymw18x" path="res://complete_scenes/entities/player/charcter_anim.gd" id="2_cjfkd"]
[ext_resource type="Script" uid="uid://couw105c3bde4" path="res://addons/godot_state_charts/state_chart.gd" id="2_u2bhs"]
[ext_resource type="Script" uid="uid://c1vp0ojjvaby1" path="res://addons/godot_state_charts/parallel_state.gd" id="3_1poog"]
[ext_resource type="Texture2D" uid="uid://tyre4wpprqyd" path="res://assets/textures/player/Action_2d_sneak_right.png" id="3_cjfkd"]
[ext_resource type="Script" uid="uid://jk2jm1g6q853" path="res://addons/godot_state_charts/compound_state.gd" id="4_hcnbt"]
[ext_resource type="Script" uid="uid://cytafq8i1y8qm" path="res://addons/godot_state_charts/atomic_state.gd" id="5_t23pu"]
[ext_resource type="Script" uid="uid://cf1nsco3w0mf6" path="res://addons/godot_state_charts/transition.gd" id="6_cjfkd"]
[ext_resource type="PackedScene" uid="uid://c522uyw28gd8c" path="res://complete_scenes/entities/entity_collision.tscn" id="7_hcnbt"]

[sub_resource type="Animation" id="Animation_cjfkd"]
resource_name = "idle"

[sub_resource type="AnimationLibrary" id="AnimationLibrary_qj4o6"]
_data = {
&"idle": SubResource("Animation_cjfkd")
}

[sub_resource type="AnimationNodeBlendSpace2D" id="AnimationNodeBlendSpace2D_cjfkd"]

[sub_resource type="AnimationNodeBlendSpace2D" id="AnimationNodeBlendSpace2D_qj4o6"]

[sub_resource type="AnimationNodeBlendSpace2D" id="AnimationNodeBlendSpace2D_ld7iu"]

[sub_resource type="AnimationNodeBlendSpace2D" id="AnimationNodeBlendSpace2D_usp81"]

[sub_resource type="AnimationNodeBlendSpace2D" id="AnimationNodeBlendSpace2D_3rt7g"]

[sub_resource type="AnimationNodeBlendSpace2D" id="AnimationNodeBlendSpace2D_lqk7r"]

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_3rt7g"]
advance_mode = 2

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_lqk7r"]
advance_mode = 2
advance_condition = &"attack"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_scn60"]
advance_mode = 2
advance_condition = &"run"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_bqy1l"]
switch_mode = 2
advance_mode = 2

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_qq88n"]
switch_mode = 2
advance_mode = 2

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_dkd4c"]
advance_mode = 2
advance_condition = &"attack"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_t4on0"]
advance_mode = 2
advance_condition = &"idle"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_k2xfj"]
advance_mode = 2
advance_condition = &"sneak"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_jh0sj"]
advance_mode = 2
advance_condition = &"idle"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_vobx8"]
advance_mode = 2
advance_condition = &"walk"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_7wec4"]
advance_mode = 2
advance_condition = &"idle"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_g2u6c"]
advance_mode = 2
advance_condition = &"attack"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_8mu28"]
advance_mode = 2
advance_condition = &"attack"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_cjfkd"]
advance_mode = 2
advance_condition = &"death"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_qj4o6"]
advance_mode = 2
advance_condition = &"death"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_ld7iu"]
advance_mode = 2
advance_condition = &"death"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_usp81"]
advance_mode = 2
advance_condition = &"death"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_lfs3t"]
advance_mode = 2
advance_condition = &"death"

[sub_resource type="AnimationNodeStateMachine" id="AnimationNodeStateMachine_cjfkd"]
states/Attack/node = SubResource("AnimationNodeBlendSpace2D_cjfkd")
states/Attack/position = Vector2(316, -19)
states/Death/node = SubResource("AnimationNodeBlendSpace2D_qj4o6")
states/Death/position = Vector2(678, 25)
states/Idle/node = SubResource("AnimationNodeBlendSpace2D_ld7iu")
states/Idle/position = Vector2(316, 141)
states/Run/node = SubResource("AnimationNodeBlendSpace2D_usp81")
states/Run/position = Vector2(640, 243)
states/Sneak/node = SubResource("AnimationNodeBlendSpace2D_3rt7g")
states/Sneak/position = Vector2(203, 243)
states/Start/position = Vector2(97, 88)
states/Walk/node = SubResource("AnimationNodeBlendSpace2D_lqk7r")
states/Walk/position = Vector2(434, 243)
transitions = ["Start", "Idle", SubResource("AnimationNodeStateMachineTransition_3rt7g"), "Idle", "Attack", SubResource("AnimationNodeStateMachineTransition_lqk7r"), "Idle", "Run", SubResource("AnimationNodeStateMachineTransition_scn60"), "Death", "End", SubResource("AnimationNodeStateMachineTransition_bqy1l"), "Attack", "Idle", SubResource("AnimationNodeStateMachineTransition_qq88n"), "Run", "Attack", SubResource("AnimationNodeStateMachineTransition_dkd4c"), "Run", "Idle", SubResource("AnimationNodeStateMachineTransition_t4on0"), "Idle", "Sneak", SubResource("AnimationNodeStateMachineTransition_k2xfj"), "Sneak", "Idle", SubResource("AnimationNodeStateMachineTransition_jh0sj"), "Idle", "Walk", SubResource("AnimationNodeStateMachineTransition_vobx8"), "Walk", "Idle", SubResource("AnimationNodeStateMachineTransition_7wec4"), "Walk", "Attack", SubResource("AnimationNodeStateMachineTransition_g2u6c"), "Sneak", "Attack", SubResource("AnimationNodeStateMachineTransition_8mu28"), "Attack", "Death", SubResource("AnimationNodeStateMachineTransition_cjfkd"), "Run", "Death", SubResource("AnimationNodeStateMachineTransition_qj4o6"), "Idle", "Death", SubResource("AnimationNodeStateMachineTransition_ld7iu"), "Walk", "Death", SubResource("AnimationNodeStateMachineTransition_usp81"), "Sneak", "Death", SubResource("AnimationNodeStateMachineTransition_lfs3t")]
graph_offset = Vector2(-62.990067, -176)

[sub_resource type="CircleShape2D" id="CircleShape2D_t23pu"]
radius = 36.013885

[node name="Player" type="CharacterBody2D"]
editor_description = "Наш братец-кролик"
collision_mask = 598
motion_mode = 1
script = ExtResource("1_2ja1o")

[node name="CharcterAnim" type="Node2D" parent="."]
script = ExtResource("2_cjfkd")

[node name="Sprite2D" type="Sprite2D" parent="CharcterAnim"]
position = Vector2(0, -64)
texture = ExtResource("3_cjfkd")
hframes = 10

[node name="AnimationPlayer" type="AnimationPlayer" parent="CharcterAnim"]
libraries = {
&"": SubResource("AnimationLibrary_qj4o6")
}

[node name="Polygon2D" type="Polygon2D" parent="CharcterAnim"]
visible = false
polygon = PackedVector2Array(-12, -17, -20, -27, -24, -45, -18, -47, -15, -34, 1, -37, 4, -51, 9, -50, 7, -37, 12, -29, 9, -19, 17, -5, 19, 13, -2, 15, -21, 14, -24, 6, -18, 5)

[node name="AnimationTree" type="AnimationTree" parent="CharcterAnim"]
tree_root = SubResource("AnimationNodeStateMachine_cjfkd")
anim_player = NodePath("../AnimationPlayer")
parameters/conditions/attack = false
parameters/conditions/death = false
parameters/conditions/idle = false
parameters/conditions/run = false
parameters/conditions/sneak = false
parameters/conditions/walk = false
parameters/Attack/blend_position = Vector2(0, 0)
parameters/Death/blend_position = Vector2(0, 0)
parameters/Idle/blend_position = Vector2(0, 0)
parameters/Run/blend_position = Vector2(0, 0)
parameters/Sneak/blend_position = Vector2(0, 0)
parameters/Walk/blend_position = Vector2(0, 0)

[node name="PlayerStateChart" type="Node" parent="."]
script = ExtResource("2_u2bhs")
metadata/_custom_type_script = "uid://couw105c3bde4"

[node name="Root" type="Node" parent="PlayerStateChart"]
script = ExtResource("3_1poog")

[node name="PlayerBehaviour" type="Node" parent="PlayerStateChart/Root"]
script = ExtResource("4_hcnbt")
initial_state = NodePath("Idle")

[node name="toStunned" type="Node" parent="PlayerStateChart/Root/PlayerBehaviour"]
script = ExtResource("6_cjfkd")
to = NodePath("../Stunned")
event = &"stunned"
delay_in_seconds = "0.0"

[node name="Run" type="Node" parent="PlayerStateChart/Root/PlayerBehaviour"]
script = ExtResource("5_t23pu")

[node name="toIdle" type="Node" parent="PlayerStateChart/Root/PlayerBehaviour/Run"]
script = ExtResource("6_cjfkd")
to = NodePath("../../Idle")
event = &"idle"
delay_in_seconds = "0.0"

[node name="toWalk" type="Node" parent="PlayerStateChart/Root/PlayerBehaviour/Run"]
script = ExtResource("6_cjfkd")
to = NodePath("../../Walk")
event = &"walking"
delay_in_seconds = "0.0"

[node name="toSneak" type="Node" parent="PlayerStateChart/Root/PlayerBehaviour/Run"]
script = ExtResource("6_cjfkd")
to = NodePath("../../Sneak")
event = &"sneaking"
delay_in_seconds = "0.0"

[node name="Walk" type="Node" parent="PlayerStateChart/Root/PlayerBehaviour"]
script = ExtResource("5_t23pu")

[node name="toIdle" type="Node" parent="PlayerStateChart/Root/PlayerBehaviour/Walk"]
script = ExtResource("6_cjfkd")
to = NodePath("../../Idle")
event = &"idle"
delay_in_seconds = "0.0"

[node name="toRun" type="Node" parent="PlayerStateChart/Root/PlayerBehaviour/Walk"]
script = ExtResource("6_cjfkd")
to = NodePath("../../Run")
event = &"running"
delay_in_seconds = "0.0"

[node name="toSneak" type="Node" parent="PlayerStateChart/Root/PlayerBehaviour/Walk"]
script = ExtResource("6_cjfkd")
to = NodePath("../../Sneak")
event = &"sneaking"
delay_in_seconds = "0.0"

[node name="Sneak" type="Node" parent="PlayerStateChart/Root/PlayerBehaviour"]
script = ExtResource("5_t23pu")

[node name="toIdle" type="Node" parent="PlayerStateChart/Root/PlayerBehaviour/Sneak"]
script = ExtResource("6_cjfkd")
to = NodePath("../../Idle")
event = &"idle"
delay_in_seconds = "0.0"

[node name="toRun" type="Node" parent="PlayerStateChart/Root/PlayerBehaviour/Sneak"]
script = ExtResource("6_cjfkd")
to = NodePath("../../Run")
event = &"running"
delay_in_seconds = "0.0"

[node name="toWalk" type="Node" parent="PlayerStateChart/Root/PlayerBehaviour/Sneak"]
script = ExtResource("6_cjfkd")
to = NodePath("../../Walk")
event = &"walking"
delay_in_seconds = "0.0"

[node name="Idle" type="Node" parent="PlayerStateChart/Root/PlayerBehaviour"]
script = ExtResource("5_t23pu")

[node name="toRun" type="Node" parent="PlayerStateChart/Root/PlayerBehaviour/Idle"]
script = ExtResource("6_cjfkd")
to = NodePath("../../Run")
event = &"running"
delay_in_seconds = "0.0"

[node name="toWalk" type="Node" parent="PlayerStateChart/Root/PlayerBehaviour/Idle"]
script = ExtResource("6_cjfkd")
to = NodePath("../../Walk")
event = &"walking"
delay_in_seconds = "0.0"

[node name="toSneak" type="Node" parent="PlayerStateChart/Root/PlayerBehaviour/Idle"]
script = ExtResource("6_cjfkd")
to = NodePath("../../Sneak")
event = &"sneaking"
delay_in_seconds = "0.0"

[node name="Stunned" type="Node" parent="PlayerStateChart/Root/PlayerBehaviour"]
script = ExtResource("5_t23pu")

[node name="toIdle" type="Node" parent="PlayerStateChart/Root/PlayerBehaviour/Stunned"]
script = ExtResource("6_cjfkd")
to = NodePath("../../Idle")
delay_in_seconds = "0.2"

[node name="PlayerMode" type="Node" parent="PlayerStateChart/Root"]
script = ExtResource("4_hcnbt")
initial_state = NodePath("BattleMode")

[node name="BattleMode" type="Node" parent="PlayerStateChart/Root/PlayerMode"]
script = ExtResource("5_t23pu")

[node name="toNormalMode" type="Node" parent="PlayerStateChart/Root/PlayerMode/BattleMode"]
script = ExtResource("6_cjfkd")
to = NodePath("../../NormalMode")
event = &"normal_mode"
delay_in_seconds = "0.0"

[node name="toCutsceneMode" type="Node" parent="PlayerStateChart/Root/PlayerMode/BattleMode"]
script = ExtResource("6_cjfkd")
to = NodePath("../../CutsceneMode")
event = &"cutscene_mode"
delay_in_seconds = "0.0"

[node name="NormalMode" type="Node" parent="PlayerStateChart/Root/PlayerMode"]
script = ExtResource("5_t23pu")

[node name="toCutsceneMode" type="Node" parent="PlayerStateChart/Root/PlayerMode/NormalMode"]
script = ExtResource("6_cjfkd")
to = NodePath("../../CutsceneMode")
event = &"cutscene_mode"
delay_in_seconds = "0.0"

[node name="toBattleMode" type="Node" parent="PlayerStateChart/Root/PlayerMode/NormalMode"]
script = ExtResource("6_cjfkd")
to = NodePath("../../BattleMode")
event = &"battle_mode"
delay_in_seconds = "0.0"

[node name="CutsceneMode" type="Node" parent="PlayerStateChart/Root/PlayerMode"]
script = ExtResource("5_t23pu")

[node name="toNormalMode" type="Node" parent="PlayerStateChart/Root/PlayerMode/CutsceneMode"]
script = ExtResource("6_cjfkd")
to = NodePath("../../NormalMode")
event = &"normal_mode"
delay_in_seconds = "0.0"

[node name="toBattleMode" type="Node" parent="PlayerStateChart/Root/PlayerMode/CutsceneMode"]
script = ExtResource("6_cjfkd")
to = NodePath("../../BattleMode")
event = &"battle_mode"
delay_in_seconds = "0.0"

[node name="PlayerCondition" type="Node" parent="PlayerStateChart/Root"]
script = ExtResource("4_hcnbt")
initial_state = NodePath("FullHealth")

[node name="FullHealth" type="Node" parent="PlayerStateChart/Root/PlayerCondition"]
script = ExtResource("5_t23pu")

[node name="MiddleState" type="Node" parent="PlayerStateChart/Root/PlayerCondition"]
script = ExtResource("5_t23pu")

[node name="LowHealth" type="Node" parent="PlayerStateChart/Root/PlayerCondition"]
script = ExtResource("5_t23pu")

[node name="EntityCollision" parent="." instance=ExtResource("7_hcnbt")]
position = Vector2(-2, -28)
shape = SubResource("CircleShape2D_t23pu")

[connection signal="state_processing" from="PlayerStateChart/Root/PlayerBehaviour/Run" to="." method="_on_run_state_processing"]
[connection signal="state_processing" from="PlayerStateChart/Root/PlayerBehaviour/Walk" to="." method="_on_walk_state_processing"]
[connection signal="state_processing" from="PlayerStateChart/Root/PlayerBehaviour/Sneak" to="." method="_on_sneak_state_processing"]
